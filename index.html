<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #3e3e3e; color: #f0f0f0; padding: 20px; }
    h1, h2 { color: #f0f0f0; }
    .board { background: #2c2c2c; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }
    .row { margin-bottom: 15px; }
    .name { font-weight: bold; margin-bottom: 5px; }
    .bar-container { width: 100%; background: #444; border-radius: 5px; overflow: hidden; height: 25px; display: flex; }
    .rsg { background: #4287f5; height: 100%; color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: width 1s ease; }
    .k5 { background: #f54291; height: 100%; color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: width 1s ease; }
	h4 { text-decoration: underline; }
	.info-row {
	  display: grid;
	  grid-template-columns: 150px 60px 100px 80px 120px 100px 120px 1fr;
	  gap: 10px;
	  font-size: 14px;
	  margin-bottom: 6px;
	}
	.info {
	  white-space: nowrap;
	}
	@media (max-width: 900px) {
  .info-row {
		grid-template-columns: repeat(2, 1fr);
		grid-auto-rows: auto;
	  }
	}

	@media (max-width: 500px) {
	  .info-row {
		grid-template-columns: 1fr;
	  }
	  body {
		padding: 10px;
	  }
	  .board {
		padding: 10px;
	  }
	}
  </style>
</head>
<body>

<h1 style="text-align: center;">Leaderboard rules</h1>

<h3>A run is the total time added from an Any % Glitchless run (IGT) to the time of an IRL 5 kilometer race.</h3>
<h3>The transition between the two runs doesn't count in order to avoid rushing, so you can choose where to run and warm up beforehand.</h3>
<h3>It is forbidden to use a race for both categories at the same time.</h3>

<a href="https://mail.google.com/mail/?view=cm&fs=1&to=rsgand5k@gmail.com
&su=Run%20Submission
&body=Player%20name:%0ARun%20video/link:%0ARSG%20time:%0ARTA%20time:%0A5K%20time:%0ASeed:%0ADate:%0AF3:%0ADifficulty:%0AMods:%0A"
target="_blank"
style="
  display:inline-block;
  margin:30px auto;
  padding:14px 22px;
  background:#3498db;
  color:white;
  border-radius:10px;
  font-size:20px;
  text-decoration:none;
  text-align:center;
">
  üì§ Post your run with Gmail
</a>

<br/><br/>
<label>Date : <input type="date" id="dateFilter" /></label>
<br/><br/>
<label>Max runs showed : <input type="number" id="topX" value="10" min="1" /></label>
<br/><br/>
<label><input type="checkbox" id="showObsolete" /> Show obsolete runs</label>

<h4>You can reset infinitely until you get the run that suits you, then run the 5K. üíª + üèÉ</h4>
<div class="board" id="leftBoard">
  <h2>RSG + 5K</h2>
</div>

<h4>First you have to run the 5K and then play the first seed generated by the game. üèÉ + üíª</h4>
<div class="board" id="rightBoard">
  <h2>5K + RSG</h2>
</div>

<script>
let pxPerMs = 0.0003;

function countryToFlag(countryCode) {
  const code = countryCode.toUpperCase();
  return code.replace(/./g, char =>
    String.fromCodePoint(127397 + char.charCodeAt(0))
  );
}

function filterBestRuns(list) {
  const best = new Map();

  list.forEach(run => {
    const total = parseTime(run.rsg) + parseTime(run.k5);

    if (!best.has(run.name) || total < best.get(run.name).total) {
      best.set(run.name, { ...run, total });
    }
  });

  return Array.from(best.values());
}

function parseTime(t) {
  return t.h*3600000 + t.m*60000 + t.s*1000 + t.ms;
}
function formatTime(ms) {
  const h = Math.floor(ms/3600000); ms%=3600000;
  const m = Math.floor(ms/60000); ms%=60000;
  const s = Math.floor(ms/1000); ms%=1000;
  if (h >= 1.0)
	return `${h}h ${m}m ${s}s ${ms}ms`;
  else
	return `${m}m ${s}s ${ms}ms`;
}

const runsRsg5k = [
  { name: "Antoine", date: "2025-11-23", version:"1.16.1", f3:"F3", country:"FR", mods:"Modded", difficulty:"Easy", rsg:{h:0,m:19,s:38,ms:397}, k5:{h:0,m:31,s:24,ms:0}, seed:"?" },
  { name: "LudovikMC", date: "2025-11-27", version:"1.16.1", f3:"No F3", country:"FR", mods:"Modded", difficulty:"Hardcore", rsg:{h:0,m:25,s:5,ms:576}, k5:{h:0,m:22,s:13,ms:0}, seed:"-5068990900990481486" },
  { name: "DesktopFolder", date: "2025-11-29", version:"1.16.1", f3:"F3", country:"CA", mods:"Modded", difficulty:"Easy", rsg:{h:0,m:16,s:10,ms:699}, k5:{h:0,m:22,s:44,ms:150}, seed:"4460252521909011407" },
  { name: "Blyde", date: "2025-11-30", version:"1.16.1", f3:"F3", country:"FR", mods:"Modded", difficulty:"Easy", rsg:{h:0,m:19,s:57,ms:071}, k5:{h:0,m:22,s:55,ms:0}, seed:"5528818920531833096" }
];
const runs5kRsg = [
  { name: "LudovikMC", date: "2025-11-23", version:"1.16.1", f3:"No F3", country:"FR", mods:"Modded", difficulty:"Hard", rsg:{h:0,m:48,s:1,ms:62}, k5:{h:0,m:19,s:57,ms:0}, seed:"9209975185873643422" },
  { name: "LudovikMC", date: "2025-11-26", version:"1.16.1", f3:"No F3", country:"FR", mods:"Modded", difficulty:"Hard", rsg:{h:0,m:37,s:30,ms:681}, k5:{h:0,m:26,s:34,ms:0}, seed:"-8377709639459139130" },
];

function getMaxTotal(list) {
  return Math.max(...list.map(r => parseTime(r.rsg)+parseTime(r.k5)));
}

function sortByTotalTime(list) {
  return list.slice().sort((a,b) => (parseTime(a.rsg)+parseTime(a.k5)) - (parseTime(b.rsg)+parseTime(b.k5)) );
}

function updatePxPerMs(list1, list2) {
  const all = [...list1, ...list2];
  if (all.length === 0) return;

  const maxTotal = Math.max(...all.map(r => parseTime(r.rsg) + parseTime(r.k5)));

  // 90% de la largeur de l'√©cran
  const targetWidth = window.innerWidth * 0.75;

  // pxPerMs dynamique
  pxPerMs = targetWidth / maxTotal;
}

function renderBoard(list, containerId, firstKey, secondKey) {
  const board = document.getElementById(containerId);
  board.querySelectorAll('.row').forEach(e => e.remove());
  if (list.length === 0) return;

  list.forEach((p, index) => {
    const t1 = parseTime(p[firstKey]);
    const t2 = parseTime(p[secondKey]);
    const total = t1 + t2;

    const row = document.createElement('div'); 
    row.className = 'row';
    row.style.display = 'flex';
    row.style.alignItems = 'flex-start';

    // Rang
    const rankDiv = document.createElement('div');
    const suffix = (n) => n===1?'st':n===2?'nd':n===3?'rd':'th';
    rankDiv.textContent = `${index+1}${suffix(index+1)}`;
    rankDiv.style.width = '40px';
    rankDiv.style.fontWeight = 'bold';
    rankDiv.style.marginRight = '10px';

    // Ligne info du joueur (au-dessus)
    const infoRow = document.createElement('div');
	infoRow.className = 'info-row';
    infoRow.innerHTML = `
	  <span class="info name">${p.name}</span>
	  <span class="info country">${countryToFlag(p.country)}</span>
	  <span class="info version">${p.version}</span>
	  <span class="info f3">${p.f3}</span>
	  <span class="info date">${p.date}</span>
	  <span class="info mods">${p.mods}</span>
	  <span class="info diff">${p.difficulty}</span>
	  <span class="info seed">üå±${p.seed}</span>
	`;
    infoRow.style.marginBottom = '5px';

    // Ligne barre + temps total
    const barRow = document.createElement('div');
    barRow.style.display = 'flex';
    barRow.style.alignItems = 'center';
    barRow.style.justifyContent = 'space-between';

    const bar = document.createElement('div'); 
    bar.className = 'bar-container';
	bar.style.width = ((t1 + t2) * pxPerMs) + 'px';
    
    const firstBar = document.createElement('div'); 
    firstBar.className = firstKey==='rsg'?'rsg':'k5';
    firstBar.style.width = (t1/total*100)+'%';
    firstBar.textContent = formatTime(t1);

    const secondBar = document.createElement('div'); 
    secondBar.className = secondKey==='rsg'?'rsg':'k5';
    secondBar.style.width = (t2/total*100)+'%';
    secondBar.textContent = formatTime(t2);

    bar.appendChild(firstBar);
    bar.appendChild(secondBar);

    const totalDiv = document.createElement('div');
    totalDiv.textContent = formatTime(total);
    totalDiv.style.whiteSpace = 'nowrap';
    totalDiv.style.marginLeft = '10px';

	const window_width = window.innerWidth;

    barRow.appendChild(bar);
    barRow.appendChild(totalDiv);

    // Colonne principale (infos + barre)
    const mainCol = document.createElement('div');
    mainCol.style.flex = '1';
    mainCol.appendChild(infoRow);
    mainCol.appendChild(barRow);

    // Ajout √† la row
    row.appendChild(rankDiv);
    row.appendChild(mainCol);
    board.appendChild(row);
  });
}

function applyFilter() {
	const date = document.getElementById('dateFilter').value;
	const topX = parseInt(document.getElementById('topX').value) || 10;
	const showObsolete = document.getElementById('showObsolete').checked;

	let f1 = runsRsg5k.filter(r => !date || r.date <= date);
	let f2 = runs5kRsg.filter(r => !date || r.date <= date);

	if (!showObsolete) {
		f1 = filterBestRuns(f1);
		f2 = filterBestRuns(f2);
	}

	f1 = sortByTotalTime(f1).slice(0, topX);
  f2 = sortByTotalTime(f2).slice(0, topX);

  // Calibrer automatiquement la largeur des barres (partie 3)
  updatePxPerMs(f1, f2);

  renderBoard(f1, 'leftBoard', 'rsg', 'k5');
  renderBoard(f2, 'rightBoard', 'k5', 'rsg');
}

window.addEventListener('DOMContentLoaded', applyFilter);
window.addEventListener('resize', applyFilter);

document.getElementById('dateFilter').addEventListener('change', applyFilter);
document.getElementById('topX').addEventListener('input', applyFilter);
document.getElementById('showObsolete').addEventListener('change', applyFilter);
</script>

</body>

</html>
